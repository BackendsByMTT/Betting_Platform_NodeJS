<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socket.IO Test</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  </head>
  <body>
    <h1>Socket.IO Test</h1>
    <button id="disconnectBtn">Disconnect</button>
    <button id="sendBetBtn">Send Bet</button>
    <button id="sendBetStart">Start Process</button>
    <div id="sports"></div>

    <script>
      const socket = io("http://localhost:5000", {
        auth: {
          token:
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2NmIzNTczY2I4YTYyYmNmMzlhODdmNDYiLCJ1c2VybmFtZSI6InBsYXllciIsInJvbGUiOiJwbGF5ZXIiLCJpYXQiOjE3MjMxODc2MjAsImV4cCI6MTcyMzI3NDAyMH0.x-cLClOkqZwcjaqLswSfOuYpAkg4oLz352qlH29vkdA",
        },
      });

      socket.on("connect", () => {
        socket.emit("getSports", { action: "INIT" });
        console.log("Connected to server");
      });

      socket.on("message", (data) => {
        console.log("Data : ", data);

        // Assuming data is an array of Sport objects
        const sportsContainer = document.getElementById("sports");
        sportsContainer.innerHTML = ""; // Clear the container before rendering

        if (data.length > 0) {
          // Create the table and header row
          const table = document.createElement("table");
          table.setAttribute("border", "1");
          const headerRow = document.createElement("tr");

          const headers = [
            "Key",
            "Active",
            "Group",
            "Description",
            "Title",
            "Has Outrights",
          ];
          headers.forEach((header) => {
            const th = document.createElement("th");
            th.textContent = header;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);

          // Populate the table with sports data
          data.forEach((sport) => {
            const row = document.createElement("tr");

            const keyCell = document.createElement("td");
            keyCell.textContent = sport.key;
            row.appendChild(keyCell);

            const activeCell = document.createElement("td");
            activeCell.textContent = sport.active ? "Yes" : "No";
            row.appendChild(activeCell);

            const groupCell = document.createElement("td");
            groupCell.textContent = sport.group;
            row.appendChild(groupCell);

            const descriptionCell = document.createElement("td");
            descriptionCell.textContent = sport.description;
            row.appendChild(descriptionCell);

            const titleCell = document.createElement("td");
            titleCell.textContent = sport.title;
            row.appendChild(titleCell);

            const hasOutrightsCell = document.createElement("td");
            hasOutrightsCell.textContent = sport.has_outrights ? "Yes" : "No";
            row.appendChild(hasOutrightsCell);

            table.appendChild(row);
          });

          sportsContainer.appendChild(table);
        } else {
          sportsContainer.textContent = "No sports data available.";
        }
      });

      socket.on("AnotherDevice", (data) => {
        console.log("Message from server:", data);
      });

      socket.on("error", (err) => {
        console.error("Socket Error:", err);
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from server");
      });

      document.getElementById("sendBetBtn").addEventListener("click", () => {
        // Generate new bet data
        const generateRandomOdds = () =>
          (Math.random() * (2.5 - 1.5) + 1.5).toFixed(2);
        const generateRandomAmount = () => Math.floor(Math.random() * 100) + 10;

        const betPayload = {
          action: "ADD",
          payload: {
            player: "64d7c2b8e3f6123456789abc",
            sport_title: "Football",
            commence_time: new Date(),
            home_team: {
              name:
                "Team " +
                String.fromCharCode(65 + Math.floor(Math.random() * 26)),
              odds: generateRandomOdds(),
            },
            away_team: {
              name:
                "Team " +
                String.fromCharCode(65 + Math.floor(Math.random() * 26)),
              odds: generateRandomOdds(),
            },
            market: "Match Winner",
            bet_on: Math.random() > 0.5 ? "home" : "away",
            amount: generateRandomAmount(),
            status: "pending",
          },
        };

        // Send the generated bet data
        socket.emit("bet", betPayload);
        console.log("Bet event sent:", betPayload);
      });

      document.getElementById("sendBetStart").addEventListener("click", () => {
        // Send the generated bet data
        socket.emit("bet", { action: "START" });
      });
    </script>
  </body>
</html>
