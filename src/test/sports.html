<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sports in Category</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      h1 {
        color: #333;
      }

      #sports {
        margin-top: 20px;
      }

      .sport-card {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 5px;
      }

      .sport-card h3 {
        margin: 0;
        color: #0066cc;
      }

      .sport-card p {
        margin: 5px 0;
      }

      .sport-card button {
        background-color: #0066cc;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
      }

      .sport-card button:hover {
        background-color: #005bb5;
      }

      .no-sports {
        color: red;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1 id="category-title">Sports in Category</h1>
    <div id="sports"></div>

    <script>
      const socket = io("http://localhost:5000", {
        auth: {
          token:
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2NmI0NjY5ZGY1MGMwZGE1MDY3OWM4MjEiLCJ1c2VybmFtZSI6InBsYXllcjIiLCJyb2xlIjoicGxheWVyIiwiaWF0IjoxNzIzNDM1MTk0LCJleHAiOjE3MjM1MjE1OTR9.TNEWGkNvHDUBadFeeFhSkk1UKQq8E74-edp_Cq9UPlo", // Replace with your actual JWT token
        },
      });

      // Extract the category name from the URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const category = urlParams.get("category");

      document.getElementById(
        "category-title"
      ).textContent = `Sports in ${category}`;

      socket.on("connect", () => {
        socket.emit("data", {
          action: "CATEGORY_SPORTS",
          payload: category,
        });
        console.log(
          `Connected to server and requested sports for category: ${category}`
        );
      });

      socket.on("data", (res) => {
        console.log("Categories received:", res);
        switch (res.type) {
          case "CATEGORY_SPORTS":
            console.log("CATEGORY_SPORTS : ", res.data);
            if (Array.isArray(res.data) && res.data.length > 0) {
              renderSports(res.data);
            } else {
              renderNoSportsMessage();
            }
            break;

          default:
            console.log("UNKOWN TYPES");
        }
      });

      socket.on("error", (err) => {
        console.error("Socket Error:", err);
        alert("An error occurred while communicating with the server.");
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from server");
        alert("Disconnected from the server. Please check your connection.");
      });

      document.getElementById("oddsButton").addEventListener("click", () => {
        const sport = "example_sport"; // Replace with actual sport
        const markets = "example_markets"; // Replace with actual markets
        const regions = "example_regions"; // Replace with actual regions

        // Navigate to the page where you want to emit the ODDS event
        window.location.href = `odds.html?sport=${sport}&markets=${markets}&regions=${regions}`;
      });

      function renderSports(sports) {
        const sportsContainer = document.getElementById("sports");
        sportsContainer.innerHTML = ""; // Clear the container before rendering

        sports.forEach((sport) => {
          const sportCard = document.createElement("div");
          sportCard.className = "sport-card";

          const sportTitle = document.createElement("h3");
          sportTitle.textContent = sport.title;
          sportCard.appendChild(sportTitle);

          const sportDescription = document.createElement("p");
          sportDescription.textContent = `Description: ${sport.description}`;
          sportCard.appendChild(sportDescription);

          const sportActive = document.createElement("p");
          sportActive.textContent = `Active: ${sport.active ? "Yes" : "No"}`;
          sportCard.appendChild(sportActive);

          const sportGroup = document.createElement("p");
          sportGroup.textContent = `Group: ${sport.group}`;
          sportCard.appendChild(sportGroup);

          const sportOutrights = document.createElement("p");
          sportOutrights.textContent = `Has Outrights: ${
            sport.has_outrights ? "Yes" : "No"
          }`;
          sportCard.appendChild(sportOutrights);

          const viewEventsButton = document.createElement("button");
          viewEventsButton.textContent = "View Events";
          viewEventsButton.onclick = () => {
            window.location.href = `events.html?sport=${sport.key}`;
          };
          sportCard.appendChild(viewEventsButton);

          const oddButton = document.createElement("button");
          oddButton.textContent = "Get Odds";
          oddButton.style.marginLeft = "16px";
          oddButton.onclick = () => {
            window.location.href = `odds.html?sport=${sport.key}&markets=h2h,spreads,totals,outrights&regions=us`;
          };
          sportCard.appendChild(oddButton);

          sportsContainer.appendChild(sportCard);
        });
      }

      function renderNoSportsMessage() {
        const sportsContainer = document.getElementById("sports");
        sportsContainer.innerHTML = ""; // Clear the container before rendering

        const noSportsMessage = document.createElement("p");
        noSportsMessage.className = "no-sports";
        noSportsMessage.textContent = "No sports available for this category.";
        sportsContainer.appendChild(noSportsMessage);
      }
    </script>
  </body>
</html>
